<td valign="TOP" width="125">

<P><a href="/BPProgInfo.asp?Page=content/pub_info.htm" title="Home">Home</a></P>

<P><a href="/BPProgInfo.asp?Page=content/cdcentral.htm" title="Content and Design Central">Content and Design Central</a></P>

<P><a href="/BPProgInfo.asp?Page=content/cdcentral_despro_corner.htm" title="Designer/Producer's Corner">Designer/Producer's Corner</a><BR>

<a href="/BPProgInfo.asp?Page=content/cdcentral_art_corner.htm" title="Artist's Corner">Artist's Corner</a><BR>

<a href="/BPProgInfo.asp?Page=content/cdcentral_audio_corner.htm" title="Audio Designer's Corner">Audio Designer's Corner</a></P>

<P><a href="/BPProgInfo.asp?Page=content/pub_guide_info.htm" 

title="Xbox Guide">Xbox Guide</a></P>

<P><a href="/BPProgInfo.asp?Page=content/pub_documentation.htm" title="Publisher Documentation">Publisher Documentation</a></P>

<P><a href="/BPProgInfo.asp?Page=content/pub_insider.htm" title="Xbox Insider">Xbox Insider</a></P>
<BR>
<BR>
</td><td><H2>Generating High Fidelity Normal Maps with 3-D Software</H2>

<P><I>By Dave McCoy, Graphics Techniques Consultant, Xbox Content and Design 
Team</I></P>

<P>This paper discusses a technique that uses off-the-shelf rendering software to generate 24-bit normal maps from 3-D models to produce bump effects that are far superior to conventional 8-bit gray scale bump maps for lighting and reflective effects.</p>


<P>Downloadable files for Discreet 3DMAX, Alias/Wavefront Maya, and Newtek Lightwave that have the appropriate material and lighting settings are available at the end of this article.</p>

<P>This technique was developed after a brainstorming dialogue with Mark Brenneman of Dynamix, and I am indebted to him for his contribution to this article.</p>

<H3>Elevation Maps</H3>


<p>Typically, bump maps are generated by creating 8-bit gray scale images, often referred to as elevation maps. In these gray scale images, white represents the most elevated features, and black, the most recessed ones. An 8-bit gray scale can represent 256 levels. Here a Beethoven bust is represented with an elevation map.</p>

<img src="/content/img/normalmap_BeethovenElevation.jpg" width="256" height="256" border="0" alt=""><BR><BR>

<p>When this map is applied to a quad as a bump map, it can simulate a bas-relief.</p>

<img src="/content/img/normalmap_Beethovencard.jpg" width="320" height="240" border="0" alt="">

<P>Elevation maps are limited in the kind of surfaces they can represent. Often, surfaces that are highly edge on do not render very accurately, which subdues the level of apparent elevation. The limitations of 256 levels of height can also introduce a terraced or grainy appearance to surfaces, and smooth surfaces and sudden angle changes do not reproduce well.</P>

<H3>Normal Maps</H3>

<P>To produce lighting effects, elevation maps are converted into normal maps. Rather than representing elevations, normal maps represent the normal of the surface at each pixel in the map. Just as normals are used to calculate lighting and reflections on actual geometry, normal maps can be used to determine at what angle light strikes a surface or what angle should be used in calculating reflections. To represent these normals, a normal map uses a 24-bit image in which different colors represent different directions. </P>

<p>Here is a normal map for the Beethoven bust. </P>

<img src="/content/img/normalmap_BeethovenNormalMap.jpg" width="256" height="256" border="0" alt=""><BR><BR>
<p>Applying this normal map to a quad allows for a much higher quality bump effect than is achievable with an elevation map. Here is a quad with the Beethoven normal map applied to it.</p>

<img src="/content/img/normalmap_BeethovenView.jpg" width="310" height="320" border="0" alt="">

<P>Notice that the overall appearance of the object is smoother and more dimensional than that created with an elevation map. This is due partially to the 8-bit resolution of an elevation map versus the 24-bit precision of a normal map; however, it is also due to inevitable artifacts introduced by the per-pixel conversion approach used by existing elevation to normal map converters and the ability of normal maps to handle sudden changes in surface orientation.</p>

<p>In this normal map for a sphere, red ranges from 255 at the far right to 0 at the left. From top to bottom, green ranges from 255 to 0. From the center of the hemisphere to the outside edge, blue ranges from 255 to 128. </p>
<img src="/content/img/normalmap_colornorm2.jpg" width="256" height="256" border="0" alt=""> RGB</p>

<p>This can be seen clearly if the separate red green and blue channels of the map are examined individually.</p>

<img src="/content/img/normalmap_colornorm2red.jpg" width="256" height="256" border="0" alt=""> RED<BR><BR>
<img src="/content/img/normalmap_colornorm2grn.jpg" width="256" height="256" border="0" alt=""> GREEN<BR><BR>
<img src="/content/img/normalmap_colornorm2blu.jpg" width="256" height="256" border="0" alt=""> BLUE<BR><BR><P>While the individual channels are very similar to a conventionally lit sphere, there are important differences.</P>

<P>Fortunately, a simple technique generates a very accurate normal map from a 3-D model. If you want to start with an elevation map rather than a 3-D model, you can apply the elevation map to a mesh as a deformation map or even map it onto a quad as a bump map and use this technique, with some limitations.</P>

<H3>Generating a Normal Map</H3>

<P>Through the use of appropriate ambient levels, material settings, and the use of negative intensity lights, normal maps can be created for any 3-D object with rendering software such as 3D MAX, Maya, Lightwave, and Avid SoftImage. This technique was used to create the sphere and Beethoven normal maps seen above.</P>

<p>To render an image that captures 3-D information for a normal map, set the ambient level to 50 percent using material or lighting settings, depending on the package used. Place a pure red light to the right of the object and a pure green light above it. Place a negative intensity pure red light to the left of the object and a negative intensity pure green light below it. Place a pure blue light directly ahead of the object. No negative blue light is required because we will be creating the image along this axis and we can't see the back of the object.</P>  

<p>Here's a diagram of the lighting setup. </p>
<img src="/content/img/normalmap_LightDiagram.jpg" width="480" height="320" border="0" alt=""><BR><BR>

<p>The object material should be set to white and all specular attributes should be set to zero so that only diffuse light is considered in the rendering. Due to some differences in light modeling, it is necessary to use different light, ambient, and surface characteristics to get the correct results in each package. I used Blinn lighting in MAX, and Lambert lighting in Maya, though other lighting models available in these packages may also work.</P>

<p>The object is rendered from the front isometric window or with a high zoom setting on a distant camera placed in front of the object when using software that does not allow isometric viewport rendering.</P>

<p>The background should be set to 50 percent gray. This is the value used to represent a zero normal in normal maps. You may also want to render an alpha map at the same time you create the normal map.</P>

<p>In addition to producing very high quality normal maps, this technique allows a number of effects that are not readily achievable using other methods for normal map creation. For example, smoothing groups can be used to create smoothed or sharp edges, something not possible with elevation maps. Additionally, you can apply procedural and drawn bump maps to surfaces, and the results will be identical to their appearance in your rendering package.</p>

<img src="/content/img/normalmap_CutBallNorm.jpg" width="256" height="256" border="0" alt=""><BR><BR>

<img src="/content/img/normalmap_CutBallView.jpg" width="256" height="256" border="0" alt=""><BR><BR>
<p>Hopefully this technique will help artists to fully exploit additional per-pixel lighting and reflection mapping effects available on the Xbox™ video game system from Microsoft.</p> 

<p>The appropriate material and lighting settings for the normal map technique described in this paper are available for download. MAX users download the MAX scene file <a href="/download/normsphere3.max">normsphere3.max</a>. Maya users download the scene file <a href="/download/NormalSphere.mb">NormalSphere.mb</a>. Lightwave users download the scene file <a href="/download/Normalball.lws">Normalball.lws</a> and the object file <a href="/download/Whiteball.lwo">Whiteball.lwo</a>.</P>

<P>As always, please contact <A 
href="mailto:content@xbox.com"><B>content@xbox.com</B></A> with any questions or 
suggested revisions or extensions to this paper.</P>

<BR>

<SMALL>Thursday, April 12, 2001</SMALL>



</td>





	

